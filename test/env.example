# Environment Configuration for Coder Workspace Plugin Tests
# Copy this file to .env and customize the values for your environment
#
# This file supports both mock testing (local) and real API testing against
# deployed Gerrit and Coder servers. See test/README.md for details.

# ============================================================================
# Test Mode Configuration
# ============================================================================

# Test mode: "mock" or "real"
# - "mock": Uses mocked API responses (no external services required)
# - "real": Connects to actual Gerrit and Coder servers for integration testing
TEST_MODE="mock"

# Enable verbose test output
TEST_VERBOSE="false"

# ============================================================================
# Gerrit Configuration (for real API testing)
# ============================================================================

# Gerrit server URL for testing plugin REST API endpoint
# This is used to test the /config/server/coder-workspace.config endpoint
GERRIT_URL="http://127.0.0.1:8080"

# Gerrit admin credentials (optional, for authenticated tests)
# GERRIT_ADMIN_USER="admin"
# GERRIT_ADMIN_PASSWORD="password"

# Gerrit API token (alternative to username/password)
# GERRIT_API_TOKEN="your-gerrit-api-token"

# For remote Gerrit servers:
# GERRIT_URL="https://gerrit.yourcompany.com"

# ============================================================================
# Coder Configuration (for real API testing)
# ============================================================================

# Coder server URL
CODER_URL="http://127.0.0.1:3000"

# Coder access URL (may differ from CODER_URL for load balancers/proxies)
CODER_ACCESS_URL="http://127.0.0.1:3000"

# Coder port (for local development)
CODER_PORT="3000"

# Coder API authentication token (required for real API testing)
# Get this from: Coder UI -> User Settings -> API Tokens
# CODER_SESSION_TOKEN="your-coder-session-token-here"

# Coder organization ID (optional, for org-scoped workspaces)
# Get this from: curl -H "Coder-Session-Token: YOUR_TOKEN" $CODER_URL/api/v2/organizations
# CODER_ORGANIZATION="your-organization-id"

# Coder user (defaults to "me" for current user)
CODER_USER="me"

# For remote Coder servers:
# CODER_URL="https://coder.yourcompany.com"
# CODER_ACCESS_URL="https://coder.yourcompany.com"

# ============================================================================
# Plugin Configuration (matches gerrit.config settings)
# ============================================================================

# These values should match your gerrit.config [plugin "coder-workspace"] settings
# Used for validating configuration loading and API calls

# Coder server URL (from gerrit.config)
PLUGIN_CODER_SERVER_URL="http://127.0.0.1:3000"

# Coder API key (from gerrit.config)
# PLUGIN_CODER_API_KEY="your-coder-session-token"

# Coder organization (from gerrit.config, optional)
# PLUGIN_CODER_ORGANIZATION="your-organization-id"

# Coder user (from gerrit.config, defaults to "me")
PLUGIN_CODER_USER="me"

# Template ID (from gerrit.config)
# PLUGIN_TEMPLATE_ID="your-template-id"

# Template Version ID (from gerrit.config, alternative to template ID)
# PLUGIN_TEMPLATE_VERSION_ID="your-template-version-id"

# Template Version Preset ID (from gerrit.config, optional)
# PLUGIN_TEMPLATE_VERSION_PRESET_ID="your-template-version-preset-id"

# Workspace name template (from gerrit.config)
PLUGIN_WORKSPACE_NAME_TEMPLATE="{repo}-{change}-{patchset}"

# Rich parameters (from gerrit.config, comma-separated NAME:from pairs)
PLUGIN_RICH_PARAMS="REPO:repo,BRANCH:branch,GERRIT_CHANGE:change,GERRIT_PATCHSET:patchset,GERRIT_CHANGE_URL:url"

# Template mappings JSON (from gerrit.config, optional)
# This is a JSON array string. Example:
# PLUGIN_TEMPLATE_MAPPINGS_JSON='[{"repo":"my/org/*","branch":"refs/heads/main","templateVersionId":"template-123"}]'

# Plugin flags (from gerrit.config)
PLUGIN_AUTOSTART="true"
PLUGIN_AUTOMATIC_UPDATES="always"
PLUGIN_TTL_MS="0"
PLUGIN_OPEN_AFTER_CREATE="true"
PLUGIN_ENABLE_DRY_RUN_PREVIEW="false"

# ============================================================================
# Test Data Configuration
# ============================================================================

# Test change context (for integration tests)
TEST_REPO="test/project"
TEST_BRANCH="refs/heads/main"
TEST_CHANGE="12345"
TEST_PATCHSET="1"

# Test workspace name (for cleanup after tests)
# TEST_WORKSPACE_NAME="test-project-12345-1"

# ============================================================================
# Mock Server Configuration (for mock testing)
# ============================================================================

# Mock server port (if running mock Coder server)
MOCK_SERVER_PORT="3001"

# Mock server URL
MOCK_SERVER_URL="http://127.0.0.1:3001"

# Enable mock server (set to "true" to use mock server instead of real Coder)
# USE_MOCK_SERVER="false"

# ============================================================================
# Test Execution Configuration
# ============================================================================

# Test timeout in milliseconds (default: 30000)
# TEST_TIMEOUT="30000"

# Skip real API tests (useful for CI/CD when credentials aren't available)
# SKIP_REAL_API_TESTS="false"

# Skip integration tests (faster test runs)
# SKIP_INTEGRATION_TESTS="false"

# Skip end-to-end tests (faster test runs)
# SKIP_E2E_TESTS="false"

# ============================================================================
# Example Configurations
# ============================================================================

# Example 1: Local development with mock testing
# TEST_MODE="mock"
# GERRIT_URL="http://127.0.0.1:8080"
# CODER_URL="http://127.0.0.1:3000"

# Example 2: Local development with real Coder API
# TEST_MODE="real"
# GERRIT_URL="http://127.0.0.1:8080"
# CODER_URL="http://127.0.0.1:3000"
# CODER_SESSION_TOKEN="your-local-token"

# Example 3: Remote servers (production-like testing)
# TEST_MODE="real"
# GERRIT_URL="https://gerrit.yourcompany.com"
# CODER_URL="https://coder.yourcompany.com"
# CODER_ACCESS_URL="https://coder.yourcompany.com"
# CODER_SESSION_TOKEN="your-production-token"
# CODER_ORGANIZATION="your-org-id"
# PLUGIN_CODER_SERVER_URL="https://coder.yourcompany.com"

# Example 4: CI/CD environment (mock only, no credentials)
# TEST_MODE="mock"
# SKIP_REAL_API_TESTS="true"
# SKIP_INTEGRATION_TESTS="false"
# SKIP_E2E_TESTS="false"
